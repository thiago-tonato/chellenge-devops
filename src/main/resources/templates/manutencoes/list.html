<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/_head :: head}"></head>
<body>
<div th:replace="~{fragments/_navbar :: navbar}"></div>

<div style="max-width: 900px; margin: 40px auto;">
    <h1 style="color:#333;">Manutenções</h1>

    <div style="text-align:right; margin-bottom:15px;" sec:authorize="hasRole('ADMIN')">
        <a th:href="@{/manutencoes/nova}"
           style="padding:8px 15px; background:#007bff; color:white; border-radius:4px; text-decoration:none;">
            Nova Manutenção
        </a>
    </div>

    <table style="width:100%; border-collapse:collapse; background:#fff;">
        <tr style="background:#f0f0f0;">
            <th style="padding:10px;">ID</th>
            <th style="padding:10px;">Moto</th>
            <th style="padding:10px;">Descrição</th>
            <th style="padding:10px;">Início</th>
            <th style="padding:10px;">Fim</th>
            <th style="padding:10px;">Status</th>
            <th style="padding:10px;" sec:authorize="hasRole('ADMIN')">Ações</th>
        </tr>
        <tr th:each="m : ${manutencoes}" style="border-bottom:1px solid #ddd;">
            <td th:text="${m.id}" style="padding:8px;"></td>
            <td th:text="${m.moto.modelo} + ' - ' + ${m.moto.identificadorUWB}" style="padding:8px;"></td>
            <td th:text="${m.descricao}" style="padding:8px;"></td>
            <td th:text="${#temporals.format(m.dataInicio, 'dd/MM/yyyy HH:mm')}" style="padding:8px;"></td>
            <td th:text="${m.dataFim != null ? #temporals.format(m.dataFim, 'dd/MM/yyyy HH:mm') : '-'}" style="padding:8px;"></td>
            <td th:text="${m.status}" style="padding:8px;"></td>
            <td style="padding:8px;" sec:authorize="hasRole('ADMIN')">
                <a th:if="${m.status.name() == 'ABERTA'}"
                   th:href="@{'/manutencoes/encerrar/' + ${m.id}}"
                   style="color:#dc3545;">Encerrar</a>
            </td>
        </tr>
    </table>
</div>

<div th:replace="~{fragments/_footer :: footer}"></div>
</body>
</html>
